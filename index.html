<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Programming Graphical Solver</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 10px; line-height: 1.5; }
        input[type="number"], select { padding: 6px; margin: 4px 2px; }
        #constraints div { margin: 8px 0; }
        canvas { border: 1px solid #ccc; margin: 20px auto; display: block; width: 100%; max-width: 700px; height: auto; aspect-ratio: 1 / 1; }
        #result { margin: 20px 0; font-weight: bold; font-size: 1.1em; color: #d32f2f; }
        .form-group { margin: 12px 0; }
        button { padding: 10px 16px; cursor: pointer; }
        @media (max-width: 600px) {
            input[type="number"], select { width: 70px; }
            button { width: 100%; margin: 8px 0; }
        }
    </style>
</head>
<body>
    <h2>Linear Programming Graphical Solver (2 Variables)</h2>
    
    <div class="form-group">
        <label>Objective:</label><br>
        <select id="opt_type">
            <option>Maximize</option>
            <option selected>Minimize</option>
        </select>
        Z = 
        <input id="coef_x" type="number" step="any" placeholder="coef x"> x
        + <input id="coef_y" type="number" step="any" placeholder="coef y"> y
        + <input id="const" type="number" step="any" placeholder="constant (optional)">
    </div>
    
    <div class="form-group">
        <label>Constraints:</label>
        <div id="constraints"></div>
        <button onclick="addConstraint()">Add Constraint</button>
    </div>
    
    <label style="display:block; margin:12px 0;">
        <input type="checkbox" id="nonneg" checked> Enforce x ≥ 0, y ≥ 0
    </label>
    
    <button onclick="solveLP()" style="background:#1976d2; color:white; border:none; border-radius:4px; padding:12px 24px;">Solve & Plot</button>
    
    <canvas id="plot"></canvas>
    
    <div id="result"></div>

    <script>
        let constraintCount = 0;
        const canvas = document.getElementById('plot');
        const ctx = canvas.getContext('2d');
        let width = 600, height = 600;
        
        function resizeCanvas() {
            const size = Math.min(window.innerWidth - 40, 700);
            canvas.width = size;
            canvas.height = size;
            width = height = size;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function addConstraint() {
            constraintCount++;
            const div = document.createElement('div');
            div.innerHTML = `
                <input id="a${constraintCount}" type="number" step="any" placeholder="coef x">
                x + <input id="b${constraintCount}" type="number" step="any" placeholder="coef y">
                y <select id="op${constraintCount}">
                    <option value="<=">≤</option>
                    <option value=">=">≥</option>
                    <option value="=">=</option>
                </select>
                <input id="d${constraintCount}" type="number" step="any" placeholder="constant">
            `;
            document.getElementById('constraints').appendChild(div);
        }

        function parseConstraint(i) {
            const a = parseFloat(document.getElementById(`a${i}`).value) || 0;
            const b = parseFloat(document.getElementById(`b${i}`).value) || 0;
            const op = document.getElementById(`op${i}`).value;
            const d = parseFloat(document.getElementById(`d${i}`).value) || 0;
            return {a, b, op, d};
        }

        function getConstraints() {
            const cons = [];
            const nonneg = document.getElementById('nonneg').checked;
            if (nonneg) {
                cons.push({a: -1, b: 0, c: 0});   // -x ≤ 0
                cons.push({a: 0, b: -1, c: 0});   // -y ≤ 0
            }
            for (let i = 1; i <= constraintCount; i++) {
                const {a, b, op, d} = parseConstraint(i);
                if (op === '<=') cons.push({a, b, c: d});
                else if (op === '>=') cons.push({a: -a, b: -b, c: -d});
                else if (op === '=') {
                    cons.push({a, b, c: d});
                    cons.push({a: -a, b: -b, c: -d});
                }
            }
            return cons;
        }

        function isFeasible(p, cons) {
            for (const c of cons) {
                if (c.a * p[0] + c.b * p[1] > c.c + 1e-8) return false;
            }
            return true;
        }

        function findCorners(cons) {
            const points = [];
            const n = cons.length;

            for (let i = 0; i < n; i++) {
                for (let j = i+1; j < n; j++) {
                    const c1 = cons[i], c2 = cons[j];
                    const det = c1.a * c2.b - c2.a * c1.b;
                    if (Math.abs(det) < 1e-8) continue;
                    const x = (c1.c * c2.b - c2.c * c1.b) / det;
                    const y = (c2.c * c1.a - c1.c * c2.a) / det;
                    if (isFeasible([x, y], cons)) points.push([x, y]);
                }
            }

            for (const c of cons) {
                if (Math.abs(c.a) > 1e-8) {
                    const x = c.c / c.a; const y = 0;
                    if (isFeasible([x, y], cons)) points.push([x, y]);
                }
                if (Math.abs(c.b) > 1e-8) {
                    const y = c.c / c.b; const x = 0;
                    if (isFeasible([x, y], cons)) points.push([x, y]);
                }
            }

            const unique = [];
            for (const p of points) {
                const rounded = [Math.round(p[0]*10000)/10000, Math.round(p[1]*10000)/10000];
                if (!unique.some(q => Math.abs(q[0]-rounded[0])<1e-6 && Math.abs(q[1]-rounded[1])<1e-6))
                    unique.push(rounded);
            }
            return unique;
        }

        function solveLP() {
            const cons = getConstraints();
            if (cons.length < 1) {
                document.getElementById('result').innerHTML = 'Please add at least some constraints.';
                return;
            }

            const corners = findCorners(cons);
            if (corners.length === 0) {
                document.getElementById('result').innerHTML = 'No feasible region found.';
                ctx.clearRect(0, 0, width, height);
                return;
            }

            const isMax = document.getElementById('opt_type').value === 'Maximize';
            const a = parseFloat(document.getElementById('coef_x').value) || 0;
            const b = parseFloat(document.getElementById('coef_y').value) || 0;
            const k = parseFloat(document.getElementById('const').value) || 0;

            let bestZ = isMax ? -Infinity : Infinity;
            let bestP = null;

            for (const [x, y] of corners) {
                const z = a * x + b * y + k;
                if ((isMax && z > bestZ) || (!isMax && z < bestZ)) {
                    bestZ = z;
                    bestP = [x, y];
                }
            }

            const xStr = bestP[0].toFixed(2).replace(/\.?0+$/, '');
            const yStr = bestP[1].toFixed(2).replace(/\.?0+$/, '');
            const zStr = bestZ.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 2});
            document.getElementById('result').innerHTML = 
                `Optimal point: x = ${xStr}, y = ${yStr}<br>Z = ${zStr}`;

            // Placeholder plot (you can expand this later)
            ctx.clearRect(0, 0, width, height);
            ctx.font = '16px Arial';
            ctx.fillStyle = '#444';
            ctx.fillText('Feasible region & solution point', width/2 - 140, height/2 - 20);
            ctx.fillText(`Optimal: (${xStr}, ${yStr})`, width/2 - 100, height/2 + 20);
        }

        // No auto-adding constraints → completely empty on load/refresh
    </script>
</body>
</html>
